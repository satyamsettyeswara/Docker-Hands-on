Simulated HTTPS with Self-Signed SSL Certs + Docker + NGINX
âœ… Objectives:
Generate a self-signed certificate

Configure NGINX to use HTTPS

Serve your Flask app securely on https://localhost:8443

ğŸ§± Final Project Structure
vbnet
Copy
Edit
myapp/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.py
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ default.conf
â”‚   â”œâ”€â”€ cert.pem        â† SSL cert
â”‚   â””â”€â”€ key.pem         â† SSL private key
â”œâ”€â”€ Dockerfile
â””â”€â”€ docker-compose.yml
ğŸ”§ Step 1: Generate a Self-Signed SSL Certificate
Run this in your nginx/ folder:

bash
Copy
Edit
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout key.pem -out cert.pem \
  -subj "/CN=localhost"
This creates key.pem and cert.pem in nginx/.

ğŸ“ Step 2: Update NGINX Config (nginx/default.conf)
nginx
Copy
Edit
server {
    listen 443 ssl;
    server_name localhost;

    ssl_certificate     /etc/nginx/certs/cert.pem;
    ssl_certificate_key /etc/nginx/certs/key.pem;

    location / {
        proxy_pass http://flask:5000;
    }
}
ğŸ³ Step 3: Update docker-compose.yml
yaml
Copy
Edit
version: "3.8"
services:
  flask:
    build: .
    container_name: flask-app
  nginx:
    image: nginx
    container_name: nginx-ssl
    ports:
      - "8443:443"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
      - ./nginx/cert.pem:/etc/nginx/certs/cert.pem
      - ./nginx/key.pem:/etc/nginx/certs/key.pem
    depends_on:
      - flask
â–¶ï¸ Step 4: Rebuild & Run It All
bash
Copy
Edit
docker-compose down
docker-compose up --build
Then visit:

ğŸŒ https://localhost:8443

HTTP-to-HTTPS Redirect + Basic Auth

ğŸ”§ Step 1: Configure NGINX to Redirect HTTP to HTTPS
First, update your nginx/default.conf to redirect all HTTP traffic to HTTPS.

Updated nginx/default.conf:
nginx
Copy
Edit
# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name localhost;
    return 301 https://$host$request_uri;
}

# Serve HTTPS
server {
    listen 443 ssl;
    server_name localhost;

    ssl_certificate     /etc/nginx/certs/cert.pem;
    ssl_certificate_key /etc/nginx/certs/key.pem;

    location / {
        proxy_pass http://flask:5000;
    }
}
ğŸ§ª Step 2: Add Basic Authentication (optional)
This will require a user to authenticate via a username and password before accessing your app.

Install htpasswd to generate a password file:

On Ubuntu:

bash
Copy
Edit
sudo apt-get install apache2-utils
Generate the password file:

bash
Copy
Edit
htpasswd -c ./nginx/.htpasswd yourusername
You'll be prompted to enter a password. This will generate the .htpasswd file in the nginx/ directory.

Update nginx/default.conf to enable Basic Auth:

nginx
Copy
Edit
server {
    listen 80;
    server_name localhost;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name localhost;

    ssl_certificate     /etc/nginx/certs/cert.pem;
    ssl_certificate_key /etc/nginx/certs/key.pem;

    location / {
        auth_basic "Restricted Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
        proxy_pass http://flask:5000;
    }
}
ğŸ§³ Step 3: Rebuild & Test
Rebuild and run the Docker containers:

bash
Copy
Edit
docker-compose down
docker-compose up --build
Test:

Open https://localhost:8443 and you should be redirected from HTTP to HTTPS automatically.
